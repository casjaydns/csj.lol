<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="../css/styles.css" />
    <script src="https://unpkg.com/vue@2.6.11/dist/vue.js" defer></script>
    <script src="../js/list.js" defer></script>
    <script src="../js/nav.js" defer></script>
    <title>URL List - URL Shortner</title>
  </head>

  <body class="min-h-screen flex flex-col">
    <!-- Nav -->
    <nav class="bg-dracula-current shadow-lg">
      <div class="container mx-auto px-4">
        <div class="flex flex-wrap justify-between items-center py-4">
          <div class="flex items-center">
            <a href="/" class="nav-link font-semibold text-lg">Home</a>
          </div>
          <!-- Mobile Menu Button -->
          <button id="mobile-menu-button" class="md:hidden text-dracula-fg hover:text-dracula-purple transition duration-200">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
          <!-- Navigation Links -->
          <div id="mobile-menu" class="hidden md:flex items-center space-x-1 w-full md:w-auto mt-4 md:mt-0">
            <a href="/list" class="nav-link-active block md:inline-block w-full md:w-auto text-center md:text-left">List</a>
            <a href="/domains" class="nav-link block md:inline-block w-full md:w-auto text-center md:text-left">Domains</a>
            <a href="/about" class="nav-link block md:inline-block w-full md:w-auto text-center md:text-left">About</a>
          </div>
        </div>
      </div>
    </nav>
    <!-- end nav -->

    <main id="app" class="flex-grow container mx-auto px-4 py-8">
      <div class="text-center mb-8">
        <img src="/favicon.ico" alt="logo" class="w-24 h-24 mx-auto mb-4" />
        <h1 class="text-3xl md:text-4xl font-bold text-dracula-purple mb-2">Shortened URLs</h1>
        <p class="text-dracula-comment">Browse all shortened links</p>
      </div>

      <!-- Loading State -->
      <div v-if="loading" class="text-center py-8">
        <div class="inline-block">
          <!-- Coffee Cup -->
          <svg class="w-24 h-24 mx-auto" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <!-- Cup -->
            <path d="M25 40 L25 70 Q25 80 35 80 L55 80 Q65 80 65 70 L65 40 Z"
                  fill="none"
                  stroke="#bd93f9"
                  stroke-width="2"/>
            <!-- Handle -->
            <path d="M65 50 Q75 50 75 60 Q75 70 65 70"
                  fill="none"
                  stroke="#bd93f9"
                  stroke-width="2"/>
            <!-- Saucer -->
            <ellipse cx="45" cy="85" rx="25" ry="3" fill="#bd93f9" opacity="0.5"/>
            <!-- Steam lines -->
            <g>
              <path d="M35 35 Q33 30 35 25"
                    fill="none"
                    stroke="#8be9fd"
                    stroke-width="1.5"
                    class="animate-steam"/>
              <path d="M45 35 Q43 30 45 25"
                    fill="none"
                    stroke="#8be9fd"
                    stroke-width="1.5"
                    class="animate-steam-delay-1"/>
              <path d="M55 35 Q53 30 55 25"
                    fill="none"
                    stroke="#8be9fd"
                    stroke-width="1.5"
                    class="animate-steam-delay-2"/>
            </g>
            <!-- Coffee -->
            <ellipse cx="45" cy="50" rx="18" ry="3" fill="#6272a4" opacity="0.8"/>
          </svg>
        </div>
        <p class="mt-4 text-dracula-comment">Brewing your URLs...</p>
      </div>

      <!-- Error State -->
      <div v-if="error" class="error-message max-w-2xl mx-auto">
        {{error}}
      </div>

      <!-- Sort and Filter Controls -->
      <div v-if="!loading && !error && urls.length > 0" class="mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
        <div class="flex items-center gap-4">
          <label class="text-dracula-comment">Sort by:</label>
          <select v-model="sort" @change="loadUrls()" class="bg-dracula-current text-dracula-fg px-4 py-2 rounded border border-dracula-comment focus:border-dracula-purple focus:outline-none">
            <option value="newest">Newest First</option>
            <option value="oldest">Oldest First</option>
          </select>
        </div>
        <div class="flex items-center gap-4">
          <label class="text-dracula-comment">Per page:</label>
          <select v-model.number="perPage" @change="changePerPage" class="bg-dracula-current text-dracula-fg px-4 py-2 rounded border border-dracula-comment focus:border-dracula-purple focus:outline-none">
            <option :value="25">25</option>
            <option :value="50">50</option>
            <option :value="100">100</option>
          </select>
        </div>
      </div>

      <!-- URL List -->
      <div v-if="!loading && urls.length > 0" class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8 max-w-6xl mx-auto">
        <div v-for="url in urls" :key="url._id" class="card hover:shadow-xl transition-all duration-200 hover:scale-105">
          <div class="flex flex-col h-full">
            <!-- Click counter badge -->
            <div class="flex justify-between items-start mb-3">
              <div class="bg-dracula-purple text-dracula-bg px-3 py-1 rounded-full text-sm font-semibold">
                {{url.clicks || 0}} {{url.clicks === 1 ? 'click' : 'clicks'}}
              </div>
              <button @click="copyToClipboard(baseUrl + '/' + url.slug, $event)"
                      class="text-dracula-comment hover:text-dracula-green transition duration-200"
                      title="Copy short URL">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
              </button>
            </div>

            <!-- Short URL -->
            <div class="mb-3">
              <div class="text-dracula-comment text-xs mb-1">Short URL</div>
              <a :href="'/' + url.slug" target="_blank"
                 class="text-dracula-cyan hover:text-dracula-green transition duration-200 font-medium break-all">
                /{{url.slug}}
              </a>
            </div>

            <!-- Original URL -->
            <div class="flex-grow mb-3">
              <div class="text-dracula-comment text-xs mb-1">Original URL</div>
              <a :href="url.url" target="_blank"
                 class="text-dracula-fg hover:text-dracula-pink transition duration-200 text-sm break-all line-clamp-2"
                 :title="url.url">
                {{url.url}}
              </a>
            </div>

            <!-- Footer with date -->
            <div class="pt-3 border-t border-dracula-comment border-opacity-30">
              <span class="text-dracula-comment text-xs">
                {{formatDate(url.createdAt || url._id)}}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div v-if="!loading && !error && urls.length === 0" class="text-center py-16">
        <div class="max-w-md mx-auto">
          <!-- Empty Coffee Cup Icon -->
          <svg class="w-32 h-32 mx-auto mb-6 text-dracula-comment" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <path d="M25 40 L25 70 Q25 80 35 80 L55 80 Q65 80 65 70 L65 40 Z"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  opacity="0.5"/>
            <path d="M65 50 Q75 50 75 60 Q75 70 65 70"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  opacity="0.5"/>
            <ellipse cx="45" cy="85" rx="25" ry="3" fill="currentColor" opacity="0.3"/>
            <!-- X mark for empty -->
            <g opacity="0.7">
              <line x1="35" y1="50" x2="55" y2="70" stroke="currentColor" stroke-width="2"/>
              <line x1="55" y1="50" x2="35" y2="70" stroke="currentColor" stroke-width="2"/>
            </g>
          </svg>
          <h2 class="text-2xl font-bold text-dracula-purple mb-2">No URLs Yet</h2>
          <p class="text-dracula-comment text-lg mb-6">Your URL collection is empty. Time to create some short links!</p>
          <a href="/" class="btn-primary inline-block">Create Your First Short URL</a>
        </div>
      </div>

      <!-- Pagination -->
      <div v-if="!loading && pagination.totalPages > 1" class="flex flex-wrap justify-center items-center gap-2 mt-8">
        <button
          @click="goToPage(pagination.page - 1)"
          :disabled="!pagination.hasPrev"
          :class="pagination.hasPrev ? 'pagination-btn' : 'pagination-btn-disabled'">
          Previous
        </button>

        <template v-for="pageNum in displayedPages">
          <button
            v-if="pageNum !== '...'"
            :key="'page-' + pageNum"
            @click="goToPage(pageNum)"
            :class="pageNum === pagination.page ? 'pagination-btn-active' : 'pagination-btn'">
            {{pageNum}}
          </button>
          <span v-else :key="'dots-' + pageNum" class="text-dracula-comment px-2">...</span>
        </template>

        <button
          @click="goToPage(pagination.page + 1)"
          :disabled="!pagination.hasNext"
          :class="pagination.hasNext ? 'pagination-btn' : 'pagination-btn-disabled'">
          Next
        </button>
      </div>

      <!-- Stats -->
      <div v-if="!loading && pagination.totalUrls > 0" class="text-center mt-8 text-dracula-comment text-sm">
        Showing {{(pagination.page - 1) * pagination.limit + 1}} - {{Math.min(pagination.page * pagination.limit, pagination.totalUrls)}} of {{pagination.totalUrls}} URLs
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-dracula-current mt-auto">
      <div class="container mx-auto px-4 py-8">
        <div class="text-center">
          <div class="mb-4">
            <a href="https://github.com/casjay" target="_blank" title="Github">
              <img alt="Github" src="https://casjaysdev-sites.github.io/static/default-icons/social/github-48x48.png" class="inline-block" />
            </a>
          </div>

          <p class="text-dracula-comment text-sm mb-2">
            Copyright 1999 - 2024
            <a href="https://casjay.pro" target="_blank" class="text-dracula-purple hover:text-dracula-pink transition duration-200">Casjays Developments</a>
            and
            <a href="https://malaks-us.github.io/jason" target="_blank" class="text-dracula-purple hover:text-dracula-pink transition duration-200">
              Jason M. Hempstead-Malak
            </a>
          </p>

          <p class="text-dracula-comment text-sm mb-4">
            Hosting by
            <a href="https://casjay.pro/hosting" target="_blank" class="text-dracula-purple hover:text-dracula-pink transition duration-200">
              Casjays Developments: Hosting
            </a>
            and powered by
            <a href="https://casjaysdev.pro" target="_blank" class="text-dracula-purple hover:text-dracula-pink transition duration-200">CasjaysDev.pro</a>
          </p>

          <div class="flex justify-center gap-4 mb-4">
            <a href="https://www.patreon.com/casjay" target="_blank">
              <img src="https://img.shields.io/badge/patreon-donate-orange.svg" alt="Casjays Patreon Page" />
            </a>
            <a href="https://www.paypal.me/casjaysdev" target="_blank">
              <img src="https://img.shields.io/badge/Donate-PayPal-green.svg" alt="Casjays Paypal Page" />
            </a>
          </div>

          <div class="text-dracula-purple text-sm">
            Made with 💜 by
            <a href="http://github.com/casjay" target="_blank" rel="noopener" class="text-dracula-cyan hover:text-dracula-green transition duration-200">
              Jason M. Hempstead (Casjay)
            </a>
            <br />
            This site is powered by
            <a href="https://github.com/casjaydns/csj.lol" target="_blank" class="text-dracula-cyan hover:text-dracula-green transition duration-200">
              open source
            </a>
            project
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>